<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">
	
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
		*
		FROM
		board natural join user
		]]>
	</select>
	
	<insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
		<![CDATA[
			INSERT INTO board
			(
				board_id,
			    title, 
			    content, 
			    count,
			    date, 
			    user_id
			)
			VALUES
			(
				NULL, 
			    #{TITLE}, 
			    #{CONTENTS}, 
			    0, 
			   "2015-12-26", 
			    1
			)
		]]>
	</insert>
	
	<!-- file db query -->
	<insert id="insertFile" parameterType="hashmap" >
	
    <![CDATA[
        INSERT INTO attached_file
        (
        	board_id,
        	file_id,
            original_file_name,
            stored_file_name,
            file_size,
            
        )
        VALUES
        (
        	NULL,
        	#{FILE_ID}
            #{ORIGINAL_FILE_NAME},
            #{STORED_FILE_NAME},
            #{FILE_SIZE},
        )
    ]]>
	</insert>
	
	<update id="updateHitCnt" parameterType="hashmap">
		<![CDATA[
			UPDATE board
			SET
				count= count +1
			WHERE
				board_id = #{IDX}	
		]]>
	</update>
	
	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				board_id,
				count,
				name,
				date,
				title,
				content
			FROM
				board natural join user
			WHERE
				board_id = #{IDX}		
		]]>
	</select>
	
	<update id="updateBoard" parameterType="hashmap">
		<![CDATA[
			UPDATE board
			SET
				title = #{TITLE},
				content = #{CONTENTS}
			WHERE
				board_id = #{IDX}	
		]]>
	</update>
	
	<update id="deleteBoard" parameterType="hashmap">
		<![CDATA[
			UPDATE board
			SET
				title = '삭제되었습니다'
			WHERE
				board_id = #{IDX}
		]]>
	</update>
</mapper>